{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "colab_type": "text",
    "id": "UOzpOQJermkv",
    "toc-hr-collapsed": false
   },
   "source": [
    "# Ch19 Time-Varying Treatment\n",
    "\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "colab_type": "text",
    "id": "7l8cTiU1rxnt"
   },
   "source": [
    "到目前为止，这本书 have dealt withfixed treatments which do not vary over time. 但是，许多因果问题涉及的治疗方法随时间而变化。例如，我们可能有兴趣估算医学治疗，生活方式，就业状况，婚姻状况，职业暴露等的因果关系。因为随着时间的推移，这些治疗 may take different values for a single individual over time，所以我们将其称为随时间变化的治疗。\n",
    "\n",
    "Table of Contents\n",
    "\n",
    "- The causal effect of time-varying treatment\n",
    "- Treatment strageties\n",
    "- Sequentially randomized experiment\n",
    "- Sequentially exchangeability\n",
    "- Identifiability under some but not all treatment strategies\n",
    "- Time-varying confounding and time-varying confounders\n",
    "\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false"
   },
   "source": [
    "<img src='https://i.loli.net/2019/08/30/ce3xCSs8T1aqwgZ.jpg' width=500/>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "colab_type": "text",
    "id": "JgwX8W072dNq"
   },
   "source": [
    "<h2> HIV 常识 </h2>\n",
    "\n",
    "The lower the CD4 cell count $L_k$,themore likely a patient is to be treated.\n",
    "\n",
    "In our HIV study, the time-varying covariate CD4 cell count $L_k$ is a consequence of the true, but unmeasured, chronic damage to the immune system $U_k$. The greater an individual’s immune damage $U_k$,the lower her CD4 cell count $L_k$ and her health status $Y$."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "colab_type": "text",
    "id": "ZgMSwou7l17d"
   },
   "source": [
    "## 知识点"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "colab_type": "text",
    "id": "QOqQ7Vm45k6k"
   },
   "source": [
    "三种典型的 time-varying treatment\n",
    "\n",
    "- a randomized experiment in which treatment $A_k$ at each time $k$ is randomly assigned with a probability that depends only on prior treatment history. If, for example, an individual’s treatment value at each month $k$ were randomly assigned with probability 0.5for individuals who did not receive treatment during the previous month ($A_{k−1}=0$), and with probability1for individualswho did receive treatment during the previous month ($A_{k−1}=0$). the proper **generalization of no confounding** by measured or unmeasured variables for time-varying treatments.   $P(A_k = 1| A_{k=1} = 0) = 0.5, P(A_k = 1| A_{k=1} = 1) = 1$\n",
    "- a randomized experiment in which treatment $A_k$ at each time $k$ is randomly assigned by the investigators with a probability that depends on prior treatment and measured covariate history. An experiment in which treatment is randomly assigned at each time $k$ to each individual is referred to as **a sequentially randomized experiment.** 它需要满足 with no direct arrows from the unmeasured prognostic factors.  在观察性研究中，有关治疗的决定通常取决于结果的预测因素，例如 prognostic factors。"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "colab_type": "text",
    "id": "kFcZ0RYG2ebM"
   },
   "source": [
    "<h2> Sequential exchangeability for $Y^g$: </h2>\n",
    "\n",
    "For any observed treatment history ̄$\\bar{A}_{k-1}=g( \\bar{A}_{k−2}, \\bar{L}_{k−1})$ compatible with strategy $g$:\n",
    "\n",
    "$$\n",
    "Y^g \\perp A_k | \\bar{A}_{k-1}, \\bar{L}_k\n",
    "$$\n",
    "\n",
    "for all strageties $g$ and $k=0, 1, ..., K$."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "colab_type": "text",
    "id": "6nTbOgIGc7Tw"
   },
   "source": [
    "In observational studies represented many causal diagrams, the mean counterfactual outcome $Y^g$ under some but not all strategies $g$ is identified. 也就是说, 因果效应的 identification 不仅仅与因果图相关，而且与对应的 strategy 相关。To illustrate why identificationis possible under some but not all strategies, we will use SWIGs in the nextsection.\n",
    "\n",
    "However, the generalized backdoor criterion does not directly show the connection between blocking backdoor paths and sequential exchangeability, because the procedure is based on causal directed acyclic graphs that do not include counterfactual outcomes. An alternative graphical check for identifiability of causal effects is based on SWIGs.\n",
    "\n",
    "(我的个人理解是从 static stragety 出发) we can identify the mean counterfactual outcome under any static strategy $(a_0, a_1)$. 我继续讨论 SWIG under dynamic regimes.\n",
    "\n",
    "That is, sequential exchangeability for $Y^g$ does not hold, which means that we cannot identify the mean counterfactualoutcome for any strategy $g$. 这里所谓的可辨识，是指相关可以当成因果，可以把条件期望当成因果效应，可以使用统计方法得到因果效应。"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "colab_type": "text",
    "id": "rNS73j4Uc1bk",
    "toc-hr-collapsed": false
   },
   "source": [
    "## Questions\n",
    "\n",
    "本部分收集不懂的问题。"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "colab_type": "text",
    "id": "yMgMVmJsc7bn"
   },
   "source": [
    "### 概率决策\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "colab_type": "text",
    "id": "6Ki6iDu-c7Xx"
   },
   "source": [
    "<h2> Sequential exchangeability for $Y^g$: </h2>\n",
    "\n",
    "For any observed treatment history ̄$\\bar{A}_{k-1}=g( \\bar{A}_{k−2}, \\bar{L}_{k−1})$ compatible with strategy $g$:\n",
    "\n",
    "$$\n",
    "Y^g \\perp A_k | \\bar{A}_{k-1}, \\bar{L}_k\n",
    "$$\n",
    "\n",
    "for all strageties $g$ and $k=0, 1, ..., K$.\n",
    "\n",
    "<h3> $\\bar{A}_{k-1}=g(\\bar{A}_{k−2}, \\bar{L}_{k−1})$ 一般不成立。。一般是概率决策 ${A}_{k-1} \\sim g(\\bar{A}_{k−2}, \\bar{L}_{k−1})$ "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "colab_type": "text",
    "id": "p1zXRFhxc7QR"
   },
   "source": []
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "Collapsed": "false",
    "colab_type": "text",
    "id": "OsZ5DJ6Ec7I5"
   },
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "Collapsed": "false",
    "colab": {},
    "colab_type": "code",
    "id": "wmmFWXxyMiD9"
   },
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "colab": {
   "authorship_tag": "ABX9TyP+UldHKBbG5FdWL2P7SQlV",
   "collapsed_sections": [],
   "name": "ch19time_varying.ipynb",
   "provenance": [],
   "toc_visible": true
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.4"
  },
  "toc": {
   "base_numbering": 1,
   "nav_menu": {},
   "number_sections": true,
   "sideBar": true,
   "skip_h1_title": false,
   "title_cell": "Table of Contents",
   "title_sidebar": "Contents",
   "toc_cell": false,
   "toc_position": {},
   "toc_section_display": true,
   "toc_window_display": true
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
